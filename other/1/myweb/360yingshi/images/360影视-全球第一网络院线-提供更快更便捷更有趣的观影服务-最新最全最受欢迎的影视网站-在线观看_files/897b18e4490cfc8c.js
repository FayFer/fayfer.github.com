(function(){if(typeof window.monitor!="undefined")return;var e="V1.2.3.1(2014.5.27)",t,n=window.location.hostname.split(".");n.length>1&&(t=n[n.length-2]+"."+n[n.length-1],t!="xiankan.com"&&t!="360kan.com"&&t!="360.cn"&&(t=""));var r=function(){var n=document,r=navigator,s=window.screen,o=document.domain.toLowerCase(),u=r.userAgent.toLowerCase(),a={trim:function(e){return e.replace(/^[\s\xa0\u3000]+|[\u3000\xa0\s]+$/g,"")}},f={on:function(e,t,n){e.addEventListener?e&&e.addEventListener(t,n,!1):e&&e.attachEvent("on"+t,n)},parentNode:function(e,t,n){n=n||5,t=t.toUpperCase();while(e&&n-->0){if(e.tagName===t)return e;e=e.parentNode}return null}},l={fix:function(e){if(!("target"in e)){var t=e.srcElement||e.target;t&&t.nodeType==3&&(t=t.parentNode),e.target=t}return e}},c=function(){function e(e){return e!=null&&e.constructor!=null?Object.prototype.toString.call(e).slice(8,-1):""}return{isArray:function(t){return e(t)=="Array"},isObject:function(e){return e!==null&&typeof e=="object"},mix:function(e,t,n){for(i in t)if(n||!(e[i]||i in e))e[i]=t[i];return e},encodeURIJson:function(e){var t=[];for(var n in e){if(e[n]==null)continue;t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]))}return t.join("&")}}}(),h={get:function(e){var t,r=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=n.cookie.match(r))?unescape(t[2]):""},set:function(e,t,r){r=r||{};var i=r.expires;typeof i=="number"&&(i=new Date,i.setTime(i.getTime()+r.expires)),n.cookie=e+"="+escape(t)+(i?";expires="+i.toGMTString():"")+(r.path?";path="+r.path:"")+(r.domain?"; domain="+r.domain:"")}},p={getProject:function(){return""},getReferrer:function(){return n.referrer},getBrowser:function(){var e={"360se-ua":"360se",TT:"tencenttraveler",Maxthon:"maxthon",GreenBrowser:"greenbrowser",Sogou:"se 1.x / se 2.x",TheWorld:"theworld"};for(i in e)if(u.indexOf(e[i])>-1)return i;var t=!1;try{+external.twGetVersion(external.twGetSecurityID(window)).replace(/\./g,"")>1013&&(t=!0)}catch(n){}if(t)return"360se-noua";var r=u.match(/(msie|chrome|safari|firefox|opera)/);return r=r?r[0]:"",r=="msie"&&(r=u.match(/msie[^;]+/)),r},getLocation:function(){var e="";try{e=location.href}catch(t){e=n.createElement("a"),e.href="",e=e.href}return e=e.replace(/[?#].*$/,""),e=/\.(s?htm|php)/.test(e)?e:e.replace(/\/$/,"")+"/",e},getGuid:function(){function e(e){var t=0,n=0,r=e.length-1;for(r;r>=0;r--){var i=parseInt(e.charCodeAt(r),10);t=(t<<6&268435455)+i+(i<<14),(n=t&266338304)!=0&&(t^=n>>21)}return t}function i(){var t=[r.appName,r.version,r.language||r.browserLanguage,r.platform,r.userAgent,s.width,"x",s.height,s.colorDepth,n.referrer].join(""),i=t.length,o=window.history.length;while(o)t+=o--^i++;return(Math.round(Math.random()*2147483647)^e(t))*2147483647}var u="__guid",a=h.get(u);if(!a){a=[e(n.domain),i(),+(new Date)+Math.random()+Math.random()].join(".");var f={expires:2592e7,path:"/"};if(t){var l="."+t;if(o.indexOf(l)>0&&o.lastIndexOf(l)==o.length-l.length||o==l)f.domain=l}h.set(u,a,f)}return function(){return a}}(),getCount:function(){var e="count",t=h.get(e);return t=(parseInt(t)||0)+1,h.set(e,t,{expires:864e5,path:"/"}),function(){return t}}(),getFlashVer:function(){var e=-1;if(r.plugins&&r.mimeTypes.length){var t=r.plugins["Shockwave Flash"];t&&t.description&&(e=t.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s)+r/,".")+".0")}else if(window.ActiveXObject&&!window.opera)for(var n=16;n>=2;n--)try{var i=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+n);if(i){var s=i.GetVariable("$version");e=s.replace(/WIN/g,"").replace(/,/g,".")}}catch(o){}return e=parseInt(e,10),function(){return e}}(),getContainerId:function(e){var t=v.areaIds;if(t){var n,r=new RegExp("^("+t.join("|")+")$","ig");while(e){if(e.id&&r.test(e.id))return(e.getAttribute("data-desc")||e.id).substr(0,100);e=e.parentNode}}return""},getContainerDesc:function(e){var t=v.areaClasses;if(t){var n,r=new RegExp("^("+t.join("|")+")$","ig");while(e){if(e.className){var i=e.className.split(" ");for(var s=0;s<i.length;s++){var o=i[s];if(r.test(o))return(e.getAttribute("data-desc")||o).substr(0,100)}}e=e.parentNode}}return""},getContainerAttr:function(e){var t=v.attrName;if(t)while(e&&e.getAttribute){if(e.getAttribute(t))return e.getAttribute(t);e=e.parentNode}return""},getText:function(e){var t="";return e.tagName.toLowerCase()=="input"?t=e.getAttribute("text")||e.getAttribute("data-text")||e.value||e.title||"":t=e.getAttribute("text")||e.getAttribute("data-text")||e.innerText||e.textContent||e.title||"",a.trim(t).substr(0,100)},getHref:function(e){try{return e.getAttribute("data-href")||e.href||""}catch(t){return""}}},d={getBase:function(){return{p:p.getProject(),u:p.getLocation(),id:p.getGuid(),guid:p.getGuid()}},getTrack:function(){return{b:p.getBrowser(),c:p.getCount(),r:p.getReferrer(),fl:p.getFlashVer()}},getClick:function(e){e=l.fix(e||event);var t=e.target,n=t.tagName,r;v.useBlock?(r=p.getContainerAttr(t),r||(r=p.getContainerId(t)),r||(r=p.getContainerDesc(t))):(r=p.getContainerId(t),r||(r=p.getContainerDesc(t)));if(!t.type||t.type!="submit"&&t.type!="button"){if(n=="AREA")return{f:p.getHref(t),c:"area:"+t.parentNode.name,cId:r};var c,h;return n=="IMG"&&(c=t),t=f.parentNode(t,"A"),t?(h=p.getText(t),{f:p.getHref(t),c:h?h:c?c.src.match(/[^\/]+$/):"",cId:r}):!1}var i=f.parentNode(t,"FORM"),s={};if(i){var o=i.id||"",u=t.id;s={f:i.action,c:"form:"+(i.name||o),cId:r};if((o=="search-form"||o=="searchForm")&&(u=="searchBtn"||u=="search-btn")){var a=m("kw")||m("search-kw")||m("kw1");s.w=a?a.value:""}}else s={f:p.getHref(t),c:p.getText(t),cId:r};return s},getKeydown:function(e){e=l.fix(e||event);if(e.keyCode!=13)return!1;var t=e.target,n=t.tagName,r;v.useBlock?(r=p.getContainerAttr(t),r||(r=p.getContainerId(t)),r||(r=p.getContainerDesc(t))):(r=p.getContainerId(t),r||(r=p.getContainerDesc(t)));if(n=="INPUT"){var i=f.parentNode(t,"FORM");if(i){var s=i.id||"",o=t.id,u={f:i.action,c:"form:"+(i.name||s),cId:r};if(o=="kw"||o=="search-kw"||o=="kw1")u.w=t.value;return u}}return!1}},v={trackUrl:"http://haostat.qihoo.com/haopv.gif",clickUrl:"http://haostat.qihoo.com/haoclk.gif",wpoUrl:"http://s.360.cn/hao360/peform.html",areaIds:[],areaClasses:["monitor-desc"],attrName:"monitor-desc",useBlock:!1},m=function(e){return document.getElementById(e)};return{version:e,util:p,data:d,config:v,sendLog:function(){return window.__monitor_imgs={},function(e){var t="log_"+ +(new Date),n=window.__monitor_imgs[t]=new Image;n.onload=n.onerror=function(){window.__monitor_imgs[t]=null,delete window.__monitor_imgs[t]},n.src=e}}(),buildLog:function(){var e="";return function(t,n){if(t===!1)return;t=t||{};var r=d.getBase();t=c.mix(r,t,!0);var i=c.encodeURIJson(t);if(i==e)return;e=i,setTimeout(function(){e=""},500),i+="&t="+ +(new Date),n=n.indexOf("?")>-1?n+"&"+i:n+"?"+i,this.sendLog(n)}}(),log:function(e,t){t=t||"click";var n=v[t+"Url"];n||alert("Error : the "+t+"url does not exist!"),this.buildLog(e,n)},setConf:function(e,t){var n={};return c.isObject(e)?n=e:n[e]=t,this.config=c.mix(this.config,n,!0),this},setConfAttr:function(e){return this.config.attrName=e,this},setUrl:function(e){return e&&(this.util.getLocation=function(){return e}),this},setProject:function(e){return e&&(this.util.getProject=function(){return e}),this},setId:function(){var e=v.areaIds,t=0,n;while(n=arguments[t++])c.isArray(n)?e=e.concat(n):e.push(n);return this.setConf("areaIds",e),this},setClass:function(){var e=v.areaClasses,t=0,n;while(n=arguments[t++])c.isArray(n)?e=e.concat(n):e.push(n);return this.setConf("areaClasses",e),this},getTrack:function(){var e=this.data.getTrack();return this.log(e,"track"),this},getClickAndKeydown:function(){var e=this;return f.on(n,"click",function(t){var n=e.data.getClick(t);e.log(n,"click")}),f.on(n,"keydown",function(t){var n=e.data.getKeydown(t);e.log(n,"click")}),this},getClickAndKeydownWithId:function(){var e=this;return f.on(n,"click",function(t){var n=e.data.getClick(t);t=t||window.event;var r=t.target||t.srcElement;r.nodeType!=9&&r.tagName.toLowerCase()!="a"&&(r=r.parentNode),r.nodeType!=9&&r.tagName.toLowerCase()!="a"&&(r=r.parentNode),r.nodeType!=9&&r.tagName.toLowerCase()=="a"&&r.getAttribute("data-monitorid")&&(n.monitorid=r.getAttribute("data-monitorid")),e.log(n,"click")}),f.on(n,"keydown",function(t){var n=e.data.getKeydown(t);e.log(n,"click")}),this}}},s=new r;(function(){var e="360kan",t=s.data.getTrack;s.data.getTrack=function(){var n=t();return n.s=e,n};var n=s.data.getClick;s.data.getClick=function(t){var r=n(t);return r.s=e,r};var r=s.data.getKeydown;s.data.getKeydown=function(t){var n=r(t);return n.s=e,n}})();var o=new r;o.setProject("v360"),o.setConf({trackUrl:"http://top.h.qhimg.com/clk.gif?track=pv",clickUrl:"http://top.h.qhimg.com/clk.gif?track=clk",wpoUrl:"http://s.360.cn/hao360/peform.html",useBlock:!0}),s.getClickAndKeydown(),window.monitor=s,window.monitor2=o,window.Monitor=r})();